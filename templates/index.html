<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@5.1.3/dist/signature_pad.umd.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap');
* {
    padding: 0;
    margin: 0;
    font-family: 'Poppins', sans-serif;
}

.flex-row {
    display: flex;
}
.wrapper {
    border: 1px solid #4b00ff;
    border-right: 0;
}
canvas#signature-pad {
    background: #fff;
    width: 100%;
    height: 100%;
    cursor: crosshair;
}
button#clear {
    height: 100%;
    background: #4b00ff;
    border: 1px solid transparent;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
}
button#clear span {
    transform: rotate(90deg);
    display: block;
}
    </style>
</head>
<body>
<div class="container mb-3">
<h3 mt-3">Use this form to create a "Notice of Cover" that can be sent to Compton.</h3>

<p>All the required information should be in your policy document from your insurer.</p>
<p>Once you have generated and download the notice, you must email it to <a href="mailto:enquiries@compton.group">enquiries@compton.group</a>. Make sure to also attach your policy documents to the email.</p>
</div>
<div class="container mb-5 mt-3">
<form action="/" method="post" id="insurance-form">
    <div class="mb-3">
        <label class="form-label" for="address">Your full address</label>
        <input class="form-control" id="address" type="text" name="address">
    </div>
    <div class="mb-3">
        <label class="form-label" for="insurer_address">Insurer full address</label>
        <input class="form-control" id="insurer_address" type="text" name="insurer_address">
    </div>
    <div class="mb-3">
        <label class="form-label" for="policy_number">Policy Number</label>
        <input class="form-control" id="policy_number" type="text" name="policy_number">
    </div>
    <div class="mb-3">
        <label class="form-label" for="insurance_sum">Total sum of insurance policy</label>
        <div class="input-group">
        <span class="input-group-text" id="basic-addon1">£</span>
        
        <input class="form-control" id="insurance_sum" type="text" name="insurance_sum">
        </div>
    </div>
    <div class="mb-3">
        <label class="form-label" for="start_date">Start date</label>
        <input class="form-control" id="start_date" type="date" name="start_date">
    </div>
    <div class="mb-3">
        <label class="form-label" for="end_date">End date</label>
        <input class="form-control" id="end_date" type="date" name="end_date">
    </div>
    <div class="mb-3">
        <label class="form-label" for="regularity">Payment Regularity</label>
        <select class="form-select" id="regularity" name="regularity">
            <option value="monthly">Monthly</option>
            <option value="annually">Annually</option>
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label" for="excess">Policy excess</label>
        <input class="form-control" id="excess" type="text" name="excess">
        <div id="excessdHelpBlock" class="form-text">
            If your policy has different excesses for different types of claims (e.g. fire, theft, flood) please enter each one separated by commas. 
            <br>
            e.g "£100 subsudence, £150 espace of water, £200 for all other claims"

        </div>
    </div>
    <div class="mb-3">
        <label class="form-label" for="renewal_date">Renewal Date</label>
        <input class="form-control" id="renewal_date" type="date" name="renewal_date">
    </div>
    <div class="mb-3">
        <label class="form-label">Signature</label>
            <div class="flex-row mb-5">
            <div class="wrapper">
            <canvas id="signature-pad" width="400" height="200"></canvas>
        </div>
        <input type="hidden" name="signature" id="signature-input" value="">
        <div class="clear-btn">
            <button class="btn btn-secondary" id="clear"><span>Clear</span></button>
        </div>
        </div>
    <input class="btn btn-primary" type="submit" value="Generate Document">
    <a class="btn btn-secondary" href="/example">Download example</a>

</form>

</div>
<div class="container mb-5">
<p>You can also just download the template and do it manualy <a class="btn btn-primary" href="/template" download>Download Template</a></p>
<p class="small">No data is collected from this form. The source code for this page is available at <a href="https://github.com/lurimax-north/insurance-notice-maker">https://github.com/lurimax-north/insurance-notice-maker</a></p>
<p class="small">Compton can go suck a fat one.</p>
</div>
<script>
var canvas = document.getElementById("signature-pad");

       function resizeCanvas() {
           var ratio = Math.max(window.devicePixelRatio || 1, 1);
           canvas.width = canvas.offsetWidth * ratio;
           canvas.height = canvas.offsetHeight * ratio;
           canvas.getContext("2d").scale(ratio, ratio);
       }
       window.onresize = resizeCanvas;
       resizeCanvas();

       var signaturePad = new SignaturePad(canvas, {
        backgroundColor: 'rgb(250,250,250)'
       });

       document.getElementById("clear").addEventListener('click', function(event){
        event.preventDefault();
        signaturePad.clear();
       })


    let form = document.getElementById("insurance-form");
    form.addEventListener("submit", event => { //add event listener
        document.getElementById("signature-input").value = signaturePad.toDataURL();
        let form = event.target;
        form.submit();
    });
       /*
    let form = document.getElementById("insurance-form");
    
    form.addEventListener("submit", event => { //add event listener
       let form = event.target;
        let formData = new FormData(form); //create the FormData from the form
        formData.set("signature", signaturePad.toDataURL()); //add the new parameters
        fetch(form.action, {method: form.method, body: new URLSearchParams(formData)})
        .then( res => { 
            filename = res.headers.get("Content-Disposition").split("filename=")[1];
            return res.blob() 
        })
        .then( blob => {
            var file = window.URL.createObjectURL(blob);
            window.location.assign(file);
        }); //make the actual request
        event.preventDefault(); //stop the original form from being submitted again, without the new parameters
});
*/
</script>
</body>

</html>